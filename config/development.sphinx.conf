indexer
{
}

searchd
{
  listen = 127.0.0.1:9315
  log = /home/wfisher/workspace/catalog/log/searchd.log
  query_log = /home/wfisher/workspace/catalog/log/searchd.query.log
  pid_file = /home/wfisher/workspace/catalog/log/searchd.development.pid
  max_matches = 10000
}

source asset_core_0
{
  type = pgsql
  sql_host = gromit-new.gina.alaska.edu
  sql_user = nssi_prod
  sql_pass = g0d0fn551
  sql_db = nssi_prod
  sql_query_pre = UPDATE "assets" SET "delta" = FALSE WHERE "delta" = TRUE
  sql_query_pre = SET TIME ZONE 'UTC'
  sql_query = SELECT "assets"."id" * 2 + 0 AS "id" , "assets"."title" AS "title", "assets"."status" AS "status", array_to_string(array_accum(COALESCE("gcmd_themes"."name", '0')), ' ') AS "gcmd_themes", array_to_string(array_accum(COALESCE("gcmd_themes"."path", '0')), ' ') AS "gcmd_theme_paths", array_to_string(array_accum(COALESCE("tags"."text", '0')), ' ') AS "tags", CAST(COALESCE("agencies"."name", '') as varchar) || ' ' || CAST(COALESCE("agencies"."acronym", '') as varchar) AS "source_agency", "agencies"."acronym" AS "source_agency_acronym", CAST(COALESCE("users"."first_name", '') as varchar) || ' ' || CAST(COALESCE("users"."last_name", '') as varchar) AS "owner", array_to_string(array_accum(COALESCE(CAST(COALESCE("locations"."name", '') as varchar) || ' ' || CAST(COALESCE("locations"."region", '') as varchar) || ' ' || CAST(COALESCE("locations"."subregion", '') as varchar), '0')), ' ') AS "locations", "asset_descriptions"."text" AS "description", "assets"."id" AS "sphinx_internal_id", 3278796120 AS "class_crc", 0 AS "sphinx_deleted", COALESCE("assets"."title", '') AS "title_sort", COALESCE("assets"."status", '') AS "status_sort", array_to_string(array_accum(COALESCE(COALESCE("gcmd_themes"."name", ''), '0')), ' ') AS "gcmd_themes_sort", array_to_string(array_accum(COALESCE(COALESCE("gcmd_themes"."path", ''), '0')), ' ') AS "gcmd_theme_paths_sort", array_to_string(array_accum(COALESCE(COALESCE("tags"."text", ''), '0')), ' ') AS "tags_sort", COALESCE("agencies"."name", '') || ' ' || COALESCE("agencies"."acronym", '') AS "source_agency_sort", COALESCE("agencies"."acronym", '') AS "source_agency_acronym_sort", COALESCE("assets"."title", '') AS "title", cast(extract(epoch from "assets"."archived_at") as int) AS "archived_at", archived_at is not null AS "archived", "licenses"."downloadable" AS "downloadable", array_to_string(array_accum(COALESCE("gcmd_themes"."id", '0')), ',') AS "gcmd_theme_ids", "agencies"."id" AS "source_agency_id", "funding_agencies_assets"."id" AS "funding_agency_id", cast(extract(epoch from "assets"."start_date") as int) AS "start_date", cast(extract(epoch from "assets"."end_date") as int) AS "end_date", cast(extract(epoch from "assets"."created_at") as int) AS "created_at", cast(extract(epoch from "assets"."updated_at") as int) AS "updated_at", "assets"."owner_id" AS "owner_id", date_part('year', start_date) AS "start_date_year", date_part('year', end_date) AS "end_date_year" FROM "assets" LEFT OUTER JOIN "assets_gcmd_themes" ON "assets_gcmd_themes"."asset_id" = "assets"."id" LEFT OUTER JOIN "gcmd_themes" ON "gcmd_themes"."id" = "assets_gcmd_themes"."gcmd_theme_id" LEFT OUTER JOIN "assets_tags" ON "assets_tags"."asset_id" = "assets"."id" LEFT OUTER JOIN "tags" ON "tags"."id" = "assets_tags"."tag_id" LEFT OUTER JOIN "agencies" ON "agencies"."id" = "assets"."source_agency_id" LEFT OUTER JOIN "users" ON "users"."id" = "assets"."owner_id" LEFT OUTER JOIN "locations" ON "locations"."locatable_id" = "assets"."id" AND "locations"."locatable_type" = 'Asset' LEFT OUTER JOIN "asset_descriptions" ON "asset_descriptions"."asset_id" = "assets"."id" LEFT OUTER JOIN "licenses" ON "licenses"."id" = "assets"."license_id" LEFT OUTER JOIN "agencies" "funding_agencies_assets" ON "funding_agencies_assets"."id" = "assets"."funding_agency_id" WHERE ("assets"."id" >= $start AND "assets"."id" <= $end AND "assets"."delta" = FALSE) GROUP BY "assets"."id", "assets"."title", "assets"."status", "agencies"."name", "agencies"."acronym", "agencies"."acronym", "users"."first_name", "users"."last_name", "asset_descriptions"."text", "assets"."id", "assets"."title", "assets"."status", "agencies"."name", "agencies"."acronym", "agencies"."acronym", "assets"."title", "assets"."archived_at", "licenses"."downloadable", "agencies"."id", "funding_agencies_assets"."id", "assets"."start_date", "assets"."end_date", "assets"."created_at", "assets"."updated_at", "assets"."owner_id"
  sql_query_range = SELECT COALESCE(MIN("id"), 1::bigint), COALESCE(MAX("id"), 1::bigint) FROM "assets" WHERE "assets"."delta" = FALSE
  sql_attr_uint = sphinx_internal_id
  sql_attr_uint = class_crc
  sql_attr_uint = sphinx_deleted
  sql_attr_uint = source_agency_id
  sql_attr_uint = funding_agency_id
  sql_attr_uint = owner_id
  sql_attr_uint = start_date_year
  sql_attr_uint = end_date_year
  sql_attr_bool = archived
  sql_attr_bool = downloadable
  sql_attr_timestamp = archived_at
  sql_attr_timestamp = start_date
  sql_attr_timestamp = end_date
  sql_attr_timestamp = created_at
  sql_attr_timestamp = updated_at
  sql_attr_str2ordinal = title_sort
  sql_attr_str2ordinal = status_sort
  sql_attr_str2ordinal = gcmd_themes_sort
  sql_attr_str2ordinal = gcmd_theme_paths_sort
  sql_attr_str2ordinal = tags_sort
  sql_attr_str2ordinal = source_agency_sort
  sql_attr_str2ordinal = source_agency_acronym_sort
  sql_attr_str2ordinal = title
  sql_attr_multi = uint gcmd_theme_ids from field
  sql_query_info = SELECT * FROM "assets" WHERE "id" = (($id - 0) / 2)
}

index asset_core
{
  source = asset_core_0
  path = /home/wfisher/workspace/catalog/db/sphinx/development/asset_core
  morphology = stem_en
  wordforms = config/wordforms.txt
  charset_type = utf-8
  min_infix_len = 3
  enable_star = 1
}

source asset_delta_0 : asset_core_0
{
  type = pgsql
  sql_host = gromit-new.gina.alaska.edu
  sql_user = nssi_prod
  sql_pass = g0d0fn551
  sql_db = nssi_prod
  sql_query_pre = 
  sql_query_pre = SET TIME ZONE 'UTC'
  sql_query = SELECT "assets"."id" * 2 + 0 AS "id" , "assets"."title" AS "title", "assets"."status" AS "status", array_to_string(array_accum(COALESCE("gcmd_themes"."name", '0')), ' ') AS "gcmd_themes", array_to_string(array_accum(COALESCE("gcmd_themes"."path", '0')), ' ') AS "gcmd_theme_paths", array_to_string(array_accum(COALESCE("tags"."text", '0')), ' ') AS "tags", CAST(COALESCE("agencies"."name", '') as varchar) || ' ' || CAST(COALESCE("agencies"."acronym", '') as varchar) AS "source_agency", "agencies"."acronym" AS "source_agency_acronym", CAST(COALESCE("users"."first_name", '') as varchar) || ' ' || CAST(COALESCE("users"."last_name", '') as varchar) AS "owner", array_to_string(array_accum(COALESCE(CAST(COALESCE("locations"."name", '') as varchar) || ' ' || CAST(COALESCE("locations"."region", '') as varchar) || ' ' || CAST(COALESCE("locations"."subregion", '') as varchar), '0')), ' ') AS "locations", "asset_descriptions"."text" AS "description", "assets"."id" AS "sphinx_internal_id", 3278796120 AS "class_crc", 0 AS "sphinx_deleted", COALESCE("assets"."title", '') AS "title_sort", COALESCE("assets"."status", '') AS "status_sort", array_to_string(array_accum(COALESCE(COALESCE("gcmd_themes"."name", ''), '0')), ' ') AS "gcmd_themes_sort", array_to_string(array_accum(COALESCE(COALESCE("gcmd_themes"."path", ''), '0')), ' ') AS "gcmd_theme_paths_sort", array_to_string(array_accum(COALESCE(COALESCE("tags"."text", ''), '0')), ' ') AS "tags_sort", COALESCE("agencies"."name", '') || ' ' || COALESCE("agencies"."acronym", '') AS "source_agency_sort", COALESCE("agencies"."acronym", '') AS "source_agency_acronym_sort", COALESCE("assets"."title", '') AS "title", cast(extract(epoch from "assets"."archived_at") as int) AS "archived_at", archived_at is not null AS "archived", "licenses"."downloadable" AS "downloadable", array_to_string(array_accum(COALESCE("gcmd_themes"."id", '0')), ',') AS "gcmd_theme_ids", "agencies"."id" AS "source_agency_id", "funding_agencies_assets"."id" AS "funding_agency_id", cast(extract(epoch from "assets"."start_date") as int) AS "start_date", cast(extract(epoch from "assets"."end_date") as int) AS "end_date", cast(extract(epoch from "assets"."created_at") as int) AS "created_at", cast(extract(epoch from "assets"."updated_at") as int) AS "updated_at", "assets"."owner_id" AS "owner_id", date_part('year', start_date) AS "start_date_year", date_part('year', end_date) AS "end_date_year" FROM "assets" LEFT OUTER JOIN "assets_gcmd_themes" ON "assets_gcmd_themes"."asset_id" = "assets"."id" LEFT OUTER JOIN "gcmd_themes" ON "gcmd_themes"."id" = "assets_gcmd_themes"."gcmd_theme_id" LEFT OUTER JOIN "assets_tags" ON "assets_tags"."asset_id" = "assets"."id" LEFT OUTER JOIN "tags" ON "tags"."id" = "assets_tags"."tag_id" LEFT OUTER JOIN "agencies" ON "agencies"."id" = "assets"."source_agency_id" LEFT OUTER JOIN "users" ON "users"."id" = "assets"."owner_id" LEFT OUTER JOIN "locations" ON "locations"."locatable_id" = "assets"."id" AND "locations"."locatable_type" = 'Asset' LEFT OUTER JOIN "asset_descriptions" ON "asset_descriptions"."asset_id" = "assets"."id" LEFT OUTER JOIN "licenses" ON "licenses"."id" = "assets"."license_id" LEFT OUTER JOIN "agencies" "funding_agencies_assets" ON "funding_agencies_assets"."id" = "assets"."funding_agency_id" WHERE ("assets"."id" >= $start AND "assets"."id" <= $end AND "assets"."delta" = TRUE) GROUP BY "assets"."id", "assets"."title", "assets"."status", "agencies"."name", "agencies"."acronym", "agencies"."acronym", "users"."first_name", "users"."last_name", "asset_descriptions"."text", "assets"."id", "assets"."title", "assets"."status", "agencies"."name", "agencies"."acronym", "agencies"."acronym", "assets"."title", "assets"."archived_at", "licenses"."downloadable", "agencies"."id", "funding_agencies_assets"."id", "assets"."start_date", "assets"."end_date", "assets"."created_at", "assets"."updated_at", "assets"."owner_id"
  sql_query_range = SELECT COALESCE(MIN("id"), 1::bigint), COALESCE(MAX("id"), 1::bigint) FROM "assets" WHERE "assets"."delta" = TRUE
  sql_attr_uint = sphinx_internal_id
  sql_attr_uint = class_crc
  sql_attr_uint = sphinx_deleted
  sql_attr_uint = source_agency_id
  sql_attr_uint = funding_agency_id
  sql_attr_uint = owner_id
  sql_attr_uint = start_date_year
  sql_attr_uint = end_date_year
  sql_attr_bool = archived
  sql_attr_bool = downloadable
  sql_attr_timestamp = archived_at
  sql_attr_timestamp = start_date
  sql_attr_timestamp = end_date
  sql_attr_timestamp = created_at
  sql_attr_timestamp = updated_at
  sql_attr_str2ordinal = title_sort
  sql_attr_str2ordinal = status_sort
  sql_attr_str2ordinal = gcmd_themes_sort
  sql_attr_str2ordinal = gcmd_theme_paths_sort
  sql_attr_str2ordinal = tags_sort
  sql_attr_str2ordinal = source_agency_sort
  sql_attr_str2ordinal = source_agency_acronym_sort
  sql_attr_str2ordinal = title
  sql_attr_multi = uint gcmd_theme_ids from field
  sql_query_info = SELECT * FROM "assets" WHERE "id" = (($id - 0) / 2)
}

index asset_delta : asset_core
{
  source = asset_delta_0
  path = /home/wfisher/workspace/catalog/db/sphinx/development/asset_delta
}

index asset
{
  type = distributed
  local = asset_delta
  local = asset_core
}

source project_core_0
{
  type = pgsql
  sql_host = gromit-new.gina.alaska.edu
  sql_user = nssi_prod
  sql_pass = g0d0fn551
  sql_db = nssi_prod
  sql_query_pre = UPDATE "projects" SET "delta" = FALSE WHERE "delta" = TRUE
  sql_query_pre = SET TIME ZONE 'UTC'
  sql_query = SELECT "projects"."id" * 2 + 1 AS "id" , "projects"."title" AS "title", "projects"."status" AS "status", array_to_string(array_accum(COALESCE("gcmd_themes"."name", '0')), ' ') AS "gcmd_themes", array_to_string(array_accum(COALESCE("gcmd_themes"."path", '0')), ' ') AS "gcmd_theme_paths", "synopses"."text" AS "synopsis", array_to_string(array_accum(COALESCE(CAST(COALESCE("agencies"."name", '') as varchar) || ' ' || CAST(COALESCE("agencies"."acronym", '') as varchar), '0')), ' ') AS "agencies", array_to_string(array_accum(COALESCE(CAST(COALESCE("locations"."name", '') as varchar) || ' ' || CAST(COALESCE("locations"."region", '') as varchar) || ' ' || CAST(COALESCE("locations"."subregion", '') as varchar), '0')), ' ') AS "locations", CAST(COALESCE("people"."first_name", '') as varchar) || ' ' || CAST(COALESCE("people"."last_name", '') as varchar) AS "primary_contact", array_to_string(array_accum(COALESCE(CAST(COALESCE("people_projects"."first_name", '') as varchar) || ' ' || CAST(COALESCE("people_projects"."last_name", '') as varchar), '0')), ' ') AS "contacts", CAST(COALESCE("users"."first_name", '') as varchar) || ' ' || CAST(COALESCE("users"."last_name", '') as varchar) AS "owner", array_to_string(array_accum(COALESCE("tags"."text", '0')), ' ') AS "tags", CAST(COALESCE("source_agencies_projects"."name", '') as varchar) || ' ' || CAST(COALESCE("source_agencies_projects"."acronym", '') as varchar) AS "source_agency", "source_agencies_projects"."acronym" AS "source_agency_acronym", "notes"."text" AS "note", "projects"."id" AS "sphinx_internal_id", 3759073650 AS "class_crc", 0 AS "sphinx_deleted", COALESCE("projects"."title", '') AS "title_sort", COALESCE("projects"."status", '') AS "status_sort", array_to_string(array_accum(COALESCE(COALESCE("gcmd_themes"."name", ''), '0')), ' ') AS "gcmd_themes_sort", array_to_string(array_accum(COALESCE(COALESCE("gcmd_themes"."path", ''), '0')), ' ') AS "gcmd_theme_paths_sort", COALESCE("users"."first_name", '') || ' ' || COALESCE("users"."last_name", '') AS "owner_sort", COALESCE("source_agencies_projects"."name", '') || ' ' || COALESCE("source_agencies_projects"."acronym", '') AS "source_agency_sort", COALESCE("source_agencies_projects"."acronym", '') AS "source_agency_acronym_sort", COALESCE("notes"."text", '') AS "note_sort", COALESCE("projects"."title", '') AS "title", cast(extract(epoch from "projects"."archived_at") as int) AS "archived_at", archived_at is not null AS "archived", cast(extract(epoch from "projects"."start_date") as int) AS "start_date", cast(extract(epoch from "projects"."end_date") as int) AS "end_date", cast(extract(epoch from "projects"."created_at") as int) AS "created_at", cast(extract(epoch from "projects"."updated_at") as int) AS "updated_at", cast(extract(epoch from "projects"."published_at") as int) AS "published_at", "projects"."owner_id" AS "owner_id", date_part('year', start_date) AS "start_date_year", date_part('year', end_date) AS "end_date_year", array_to_string(array_accum(COALESCE("gcmd_themes"."id", '0')), ',') AS "gcmd_theme_ids", "source_agencies_projects"."id" AS "source_agency_id", "funding_agencies_projects"."id" AS "funding_agency_id", array_to_string(array_accum(COALESCE("agencies"."id", '0')), ',') AS "agency_ids", (published_at IS NOT NULL) AS "published" FROM "projects" LEFT OUTER JOIN "gcmd_themes_projects" ON "gcmd_themes_projects"."project_id" = "projects"."id" LEFT OUTER JOIN "gcmd_themes" ON "gcmd_themes"."id" = "gcmd_themes_projects"."gcmd_theme_id" LEFT OUTER JOIN "synopses" ON "synopses"."project_id" = "projects"."id" LEFT OUTER JOIN "project_agencies" ON "projects"."id" = "project_agencies"."project_id" LEFT OUTER JOIN "agencies" ON "agencies"."id" = "project_agencies"."agency_id" LEFT OUTER JOIN "locations" ON "locations"."locatable_id" = "projects"."id" AND "locations"."locatable_type" = 'Project' LEFT OUTER JOIN "people" ON "people"."id" = "projects"."primary_contact_id" LEFT OUTER JOIN "project_contacts" ON "projects"."id" = "project_contacts"."project_id" LEFT OUTER JOIN "people" "people_projects" ON "people_projects"."id" = "project_contacts"."person_id" LEFT OUTER JOIN "users" ON "users"."id" = "projects"."owner_id" LEFT OUTER JOIN "projects_tags" ON "projects_tags"."project_id" = "projects"."id" LEFT OUTER JOIN "tags" ON "tags"."id" = "projects_tags"."tag_id" LEFT OUTER JOIN "agencies" "source_agencies_projects" ON "source_agencies_projects"."id" = "projects"."source_agency_id" LEFT OUTER JOIN "notes" ON "notes"."noted_id" = "projects"."id" AND "notes"."noted_type" = 'Project' LEFT OUTER JOIN "agencies" "funding_agencies_projects" ON "funding_agencies_projects"."id" = "projects"."funding_agency_id" WHERE ("projects"."id" >= $start AND "projects"."id" <= $end AND "projects"."delta" = FALSE) GROUP BY "projects"."id", "projects"."title", "projects"."status", "synopses"."text", "people"."first_name", "people"."last_name", "users"."first_name", "users"."last_name", "source_agencies_projects"."name", "source_agencies_projects"."acronym", "source_agencies_projects"."acronym", "notes"."text", "projects"."id", "projects"."title", "projects"."status", "users"."first_name", "users"."last_name", "source_agencies_projects"."name", "source_agencies_projects"."acronym", "source_agencies_projects"."acronym", "notes"."text", "projects"."title", "projects"."archived_at", "projects"."start_date", "projects"."end_date", "projects"."created_at", "projects"."updated_at", "projects"."published_at", "projects"."owner_id", "source_agencies_projects"."id", "funding_agencies_projects"."id"
  sql_query_range = SELECT COALESCE(MIN("id"), 1::bigint), COALESCE(MAX("id"), 1::bigint) FROM "projects" WHERE "projects"."delta" = FALSE
  sql_attr_uint = sphinx_internal_id
  sql_attr_uint = class_crc
  sql_attr_uint = sphinx_deleted
  sql_attr_uint = owner_id
  sql_attr_uint = start_date_year
  sql_attr_uint = end_date_year
  sql_attr_uint = source_agency_id
  sql_attr_uint = funding_agency_id
  sql_attr_bool = archived
  sql_attr_bool = published
  sql_attr_timestamp = archived_at
  sql_attr_timestamp = start_date
  sql_attr_timestamp = end_date
  sql_attr_timestamp = created_at
  sql_attr_timestamp = updated_at
  sql_attr_timestamp = published_at
  sql_attr_str2ordinal = title_sort
  sql_attr_str2ordinal = status_sort
  sql_attr_str2ordinal = gcmd_themes_sort
  sql_attr_str2ordinal = gcmd_theme_paths_sort
  sql_attr_str2ordinal = owner_sort
  sql_attr_str2ordinal = source_agency_sort
  sql_attr_str2ordinal = source_agency_acronym_sort
  sql_attr_str2ordinal = note_sort
  sql_attr_str2ordinal = title
  sql_attr_multi = uint gcmd_theme_ids from field
  sql_attr_multi = uint agency_ids from field
  sql_query_info = SELECT * FROM "projects" WHERE "id" = (($id - 1) / 2)
}

index project_core
{
  source = project_core_0
  path = /home/wfisher/workspace/catalog/db/sphinx/development/project_core
  morphology = stem_en
  wordforms = config/wordforms.txt
  charset_type = utf-8
  min_infix_len = 3
  enable_star = 1
}

source project_delta_0 : project_core_0
{
  type = pgsql
  sql_host = gromit-new.gina.alaska.edu
  sql_user = nssi_prod
  sql_pass = g0d0fn551
  sql_db = nssi_prod
  sql_query_pre = 
  sql_query_pre = SET TIME ZONE 'UTC'
  sql_query = SELECT "projects"."id" * 2 + 1 AS "id" , "projects"."title" AS "title", "projects"."status" AS "status", array_to_string(array_accum(COALESCE("gcmd_themes"."name", '0')), ' ') AS "gcmd_themes", array_to_string(array_accum(COALESCE("gcmd_themes"."path", '0')), ' ') AS "gcmd_theme_paths", "synopses"."text" AS "synopsis", array_to_string(array_accum(COALESCE(CAST(COALESCE("agencies"."name", '') as varchar) || ' ' || CAST(COALESCE("agencies"."acronym", '') as varchar), '0')), ' ') AS "agencies", array_to_string(array_accum(COALESCE(CAST(COALESCE("locations"."name", '') as varchar) || ' ' || CAST(COALESCE("locations"."region", '') as varchar) || ' ' || CAST(COALESCE("locations"."subregion", '') as varchar), '0')), ' ') AS "locations", CAST(COALESCE("people"."first_name", '') as varchar) || ' ' || CAST(COALESCE("people"."last_name", '') as varchar) AS "primary_contact", array_to_string(array_accum(COALESCE(CAST(COALESCE("people_projects"."first_name", '') as varchar) || ' ' || CAST(COALESCE("people_projects"."last_name", '') as varchar), '0')), ' ') AS "contacts", CAST(COALESCE("users"."first_name", '') as varchar) || ' ' || CAST(COALESCE("users"."last_name", '') as varchar) AS "owner", array_to_string(array_accum(COALESCE("tags"."text", '0')), ' ') AS "tags", CAST(COALESCE("source_agencies_projects"."name", '') as varchar) || ' ' || CAST(COALESCE("source_agencies_projects"."acronym", '') as varchar) AS "source_agency", "source_agencies_projects"."acronym" AS "source_agency_acronym", "notes"."text" AS "note", "projects"."id" AS "sphinx_internal_id", 3759073650 AS "class_crc", 0 AS "sphinx_deleted", COALESCE("projects"."title", '') AS "title_sort", COALESCE("projects"."status", '') AS "status_sort", array_to_string(array_accum(COALESCE(COALESCE("gcmd_themes"."name", ''), '0')), ' ') AS "gcmd_themes_sort", array_to_string(array_accum(COALESCE(COALESCE("gcmd_themes"."path", ''), '0')), ' ') AS "gcmd_theme_paths_sort", COALESCE("users"."first_name", '') || ' ' || COALESCE("users"."last_name", '') AS "owner_sort", COALESCE("source_agencies_projects"."name", '') || ' ' || COALESCE("source_agencies_projects"."acronym", '') AS "source_agency_sort", COALESCE("source_agencies_projects"."acronym", '') AS "source_agency_acronym_sort", COALESCE("notes"."text", '') AS "note_sort", COALESCE("projects"."title", '') AS "title", cast(extract(epoch from "projects"."archived_at") as int) AS "archived_at", archived_at is not null AS "archived", cast(extract(epoch from "projects"."start_date") as int) AS "start_date", cast(extract(epoch from "projects"."end_date") as int) AS "end_date", cast(extract(epoch from "projects"."created_at") as int) AS "created_at", cast(extract(epoch from "projects"."updated_at") as int) AS "updated_at", cast(extract(epoch from "projects"."published_at") as int) AS "published_at", "projects"."owner_id" AS "owner_id", date_part('year', start_date) AS "start_date_year", date_part('year', end_date) AS "end_date_year", array_to_string(array_accum(COALESCE("gcmd_themes"."id", '0')), ',') AS "gcmd_theme_ids", "source_agencies_projects"."id" AS "source_agency_id", "funding_agencies_projects"."id" AS "funding_agency_id", array_to_string(array_accum(COALESCE("agencies"."id", '0')), ',') AS "agency_ids", (published_at IS NOT NULL) AS "published" FROM "projects" LEFT OUTER JOIN "gcmd_themes_projects" ON "gcmd_themes_projects"."project_id" = "projects"."id" LEFT OUTER JOIN "gcmd_themes" ON "gcmd_themes"."id" = "gcmd_themes_projects"."gcmd_theme_id" LEFT OUTER JOIN "synopses" ON "synopses"."project_id" = "projects"."id" LEFT OUTER JOIN "project_agencies" ON "projects"."id" = "project_agencies"."project_id" LEFT OUTER JOIN "agencies" ON "agencies"."id" = "project_agencies"."agency_id" LEFT OUTER JOIN "locations" ON "locations"."locatable_id" = "projects"."id" AND "locations"."locatable_type" = 'Project' LEFT OUTER JOIN "people" ON "people"."id" = "projects"."primary_contact_id" LEFT OUTER JOIN "project_contacts" ON "projects"."id" = "project_contacts"."project_id" LEFT OUTER JOIN "people" "people_projects" ON "people_projects"."id" = "project_contacts"."person_id" LEFT OUTER JOIN "users" ON "users"."id" = "projects"."owner_id" LEFT OUTER JOIN "projects_tags" ON "projects_tags"."project_id" = "projects"."id" LEFT OUTER JOIN "tags" ON "tags"."id" = "projects_tags"."tag_id" LEFT OUTER JOIN "agencies" "source_agencies_projects" ON "source_agencies_projects"."id" = "projects"."source_agency_id" LEFT OUTER JOIN "notes" ON "notes"."noted_id" = "projects"."id" AND "notes"."noted_type" = 'Project' LEFT OUTER JOIN "agencies" "funding_agencies_projects" ON "funding_agencies_projects"."id" = "projects"."funding_agency_id" WHERE ("projects"."id" >= $start AND "projects"."id" <= $end AND "projects"."delta" = TRUE) GROUP BY "projects"."id", "projects"."title", "projects"."status", "synopses"."text", "people"."first_name", "people"."last_name", "users"."first_name", "users"."last_name", "source_agencies_projects"."name", "source_agencies_projects"."acronym", "source_agencies_projects"."acronym", "notes"."text", "projects"."id", "projects"."title", "projects"."status", "users"."first_name", "users"."last_name", "source_agencies_projects"."name", "source_agencies_projects"."acronym", "source_agencies_projects"."acronym", "notes"."text", "projects"."title", "projects"."archived_at", "projects"."start_date", "projects"."end_date", "projects"."created_at", "projects"."updated_at", "projects"."published_at", "projects"."owner_id", "source_agencies_projects"."id", "funding_agencies_projects"."id"
  sql_query_range = SELECT COALESCE(MIN("id"), 1::bigint), COALESCE(MAX("id"), 1::bigint) FROM "projects" WHERE "projects"."delta" = TRUE
  sql_attr_uint = sphinx_internal_id
  sql_attr_uint = class_crc
  sql_attr_uint = sphinx_deleted
  sql_attr_uint = owner_id
  sql_attr_uint = start_date_year
  sql_attr_uint = end_date_year
  sql_attr_uint = source_agency_id
  sql_attr_uint = funding_agency_id
  sql_attr_bool = archived
  sql_attr_bool = published
  sql_attr_timestamp = archived_at
  sql_attr_timestamp = start_date
  sql_attr_timestamp = end_date
  sql_attr_timestamp = created_at
  sql_attr_timestamp = updated_at
  sql_attr_timestamp = published_at
  sql_attr_str2ordinal = title_sort
  sql_attr_str2ordinal = status_sort
  sql_attr_str2ordinal = gcmd_themes_sort
  sql_attr_str2ordinal = gcmd_theme_paths_sort
  sql_attr_str2ordinal = owner_sort
  sql_attr_str2ordinal = source_agency_sort
  sql_attr_str2ordinal = source_agency_acronym_sort
  sql_attr_str2ordinal = note_sort
  sql_attr_str2ordinal = title
  sql_attr_multi = uint gcmd_theme_ids from field
  sql_attr_multi = uint agency_ids from field
  sql_query_info = SELECT * FROM "projects" WHERE "id" = (($id - 1) / 2)
}

index project_delta : project_core
{
  source = project_delta_0
  path = /home/wfisher/workspace/catalog/db/sphinx/development/project_delta
}

index project
{
  type = distributed
  local = project_delta
  local = project_core
}

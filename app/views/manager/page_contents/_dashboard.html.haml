.navbar.navbar-static-top
  .navbar-inner
    .brand Pages
    #not-sorting.pull-right.btn-group
      = link_to '#', class: 'btn', id: 'sort-btn' do
        %i.icon-random
        Reorder Pages
      = link_to new_manager_page_content_path, class: 'btn btn-success' do
        %i.icon-plus.icon-white
        New Page
    #sorting.pull-right.btn-group{style: 'display:none;'}
      = link_to '#', class: 'btn btn-warning', id: 'cancel-sort-btn' do
        %i.icon-remove.icon-white
        Cancel
      = link_to '#', class: 'btn btn-primary', id: 'finish-sort-btn' do
        %i.icon-ok.icon-white
        Finish Page Reorder
%ol#page-content-list.page-list.sortable
  - current_setup.pages.roots.each do |page|
    - # shouldn't be necessary
    - next unless page.setups.include?(current_setup)
    = render '/manager/page_contents/page', page: page

:javascript
  $('#sort-btn').on('click', function() {
    $('#page-content-list').nestedSortable({
      handle: 'div',
      items: 'li',
      toleranceElement: '> div'
    });
    
    $('#not-sorting.btn-group').hide();
    $('#sorting.btn-group').show();
  });
  
  $('#finish-sort-btn').on('click', function() {
    $('#not-sorting.btn-group').show();
    $('#sorting.btn-group').hide();
    
    var results = $('#page-content-list').nestedSortable('toHierarchy');
    $.post('#{sort_manager_page_contents_path}', { pages: results });
  });

  $('#cancel-sort-btn').on('click', function() {
    var r = confirm("Are you sure?");
    if (r==true)
    {
    location.reload();
    }
  })

- cache([:search_result, :v13, catalog]) do
  .result{id: dom_id(catalog, :record), data: { wkt: catalog.geometry_center_collection, type: catalog.type, title: "Record Details", content: "Click on the record title to see more information.", trigger: "hover", placement: "right", toggle: "popover" } }
    .row-fluid
      .span10
        %h5.title
          = link_to "##{dom_id(catalog, :description)}", data: { toggle: "collapse" } do
            %i.icon-chevron-down.collapse-icon
            = catalog.title.try(:truncate,78)
          - if !catalog.published?
            %i.icon-warning-sign{ data: { title: 'Catalog Record Not Public', content: "This data record has not been made public yet by the site manager.", trigger: "hover", placement: "top", toggle: "popover", container: "##{dom_id(catalog, :record)}" }}
          - unless catalog.geometry_collection.blank?
            %i.icon-globe{ data: { title: 'Geographic Location', content: "This record has a geographic location and can be seen on the map above.", trigger: "hover", placement: "top", toggle: "popover", container: "##{dom_id(catalog, :record)}" }}
      .span2
        .legend-tag.alert{ class: (catalog.type == 'Project' ? 'alert-warning' : 'alert-info'), data: {title: "Record Type Indicator", content: "The record type (Data or Project).", trigger: "hover", placement: "top", toggle: "popover", container: "##{dom_id(catalog, :record)}" }}
          %b= catalog.type == 'Project' ? 'Project' : 'Data'
    .description
      - unless catalog.source_agency.nil?
        %b= catalog.source_agency.try(:name_with_acronym)
      :markdown
        #{catalog.description.try(:truncate, 300).try(:html_safe)}
      /.try(:truncate, 200)}

    .collapse{id: dom_id(catalog, :description)}
      - if !catalog.published?
        .alert.alert-warning
          This record has not been published
      .status
        = render 'status', item: catalog
  
        - unless catalog.collections.list.blank?
          %b Collections: 
          = catalog.collections.list
          
.pull-right{ style: 'margin: 0 5px 5px 0;'}
  - unless catalog.geometry_center_collection.blank?
    .btn-group
      = link_to '#', class: 'btn', data: { "openlayers-action" => "select-features", target: "##{dom_id(catalog, :record)}", title: "Zoom To Record", content: "Zoom to the record location on the map.", trigger: "hover", placement: "bottom", toggle: "popover", container: "##{dom_id(catalog, :record)}" } do
        %i.icon-search
        Zoom To
      
  - if user_signed_in?
    - available_portals = member_portals# - catalog.setups - current_setup.ancestors
    - if catalog.published? and available_portals.count > 0
      .btn-group
        = link_to '#', class: 'btn dropdown-toggle', data: { toggle: 'dropdown' } do
          %i.icon-share
          Share...
          %b.caret
        %ul.dropdown-menu
          - available_portals.each do |p|
            - next unless current_user.memberships.where(setup_id: p.id).first.can_manage_catalog?
            %li
              = link_to share_manager_catalog_path(catalog, setup_id: p), method: 'PUT', remote: true do
                - if catalog.available_in?(p)
                  %i.icon-check
                - else
                  %i.icon-check-empty
                = p.full_title

            
    - if current_member.can_manage_catalog? and catalog.owner_setup == current_setup
      .btn-group
        = link_to edit_manager_catalog_path(catalog), class: 'btn', target: :_blank, data: { title: "Edit Record", content: "Edit this record.", trigger: "hover", placement: "bottom", toggle: "popover", container: "##{dom_id(catalog, :record)}" } do
          %i.icon-edit
          Edit

  - if catalog.downloadable?
    .btn-group
      = link_to catalog_downloads_path(catalog), class: 'btn', remote: true, data: { title: "Download Files", content: "Download all of the files that are associated with this record.", trigger: "hover", placement: "bottom", toggle: "popover", container: "##{dom_id(catalog, :record)}" } do
        %i.icon-cloud-download
        Download
  .btn-group
    = link_to catalog, class: 'btn btn-primary', data: { title: "Full Data Record", content: "View all of the details for this record.", trigger: "hover", placement: "bottom", toggle: "popover", container: "##{dom_id(catalog, :record)}" } do
      Full Record
      %i.icon-arrow-right

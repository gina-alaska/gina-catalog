- unless facets.nil? or facets.empty?
  - selected = Array.wrap(@search_params[field])
  - if (selected & (facets.map{|k,v| k.to_s})).size == selected.size
    - colclass = ""
    - colicon = "fa-chevron-circle-down"
    - togicon = "fa-chevron-circle-up"
  - else
    - colclass = "in"
    - colicon = "fa-chevron-circle-up"
    - togicon = "fa-chevron-circle-down"

  .panel-body.panel-break
    %span.panel-title= "#{title} - #{facets.count}"

    .pull-right
      .sort-btns.btn-group
        = link_to '#', class: 'btn btn-default btn-sm sort-by', title: 'Sort Alphabetically', data: { target: "##{field}-search".dasherize, sort: 'alpha', direction: 'asc' } do
          %i.fa.fa-sort-alpha-asc
        = link_to '#', class: 'btn btn-default btn-sm sort-by active', title: 'Sort by Counts', data: { target: "##{field}-search".dasherize, sort: 'numeric', direction: 'desc' } do
          %i.fa.fa-sort-numeric-desc
      = link_to "##{field.to_s.dasherize}-search", class: 'btn btn-default btn-sm', title: 'Toggle show more', data: { toggle: 'expand', 'toggleicon' => "fa #{togicon}" } do
        %i.fa{class: "#{colicon}"}

  .facet-list.panel-body.collapse.expand{ id: "#{field}-search".dasherize, style: 'padding-top: 5px; padding-bottom: 0px;', class: "#{colclass}"}
    - facets.each do |facet|
      - next if facet['hidden']
      %span.facet-item{ data: { alpha: facet['display_name'], numeric: facet['doc_count'] } }
        %span.pull-right.badge.badge-default
          = facet['doc_count']
        %div{ style: 'margin-right: 30px; white-space: nowrap; overflow:hidden; text-overflow: ellipsis;' }
          %label
            = check_box_tag "search[#{field}][]", facet['key'], selected.try(:include?, facet['key'].to_s)
            = facet['display_name']

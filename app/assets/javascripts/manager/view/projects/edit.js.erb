/**
 * @class Manager.view.project.Edit
 * @extends Ext.panel.Panel
 * Edit Panel for Projects
 */
Ext.define('Manager.view.project.Edit', {
    extend: 'Ext.form.Panel', 
    alias: 'widget.project_edit',

    config: {
      recordId: null
    },
    
    titleTpl: new Ext.Template('Edit {id}::{title}'),

    constructor: function(config) {
      this.initConfig(config);
      this.callParent(arguments);
    },

    initComponent: function() {
      var source_agencies = Ext.create('Manager.store.Agencies', { autoLoad: true });
      var agencies = Ext.create('Manager.store.Agencies', { autoLoad: true });
      agencies.sort('name_with_acronym');
      
      Ext.apply(this, {
        title: 'Loading...',
        closable: true,
        bodyStyle: 'padding: 3px;',
        fieldDefaults: { anchor: '100%' },
        items: [{
          xtype:'textfield',
          fieldLabel: 'Title',
          name: 'title'
        }, {
          xtype: 'textarea',
          fieldLabel: 'Description',
          name: 'description'
        }, {
          xtype: 'textfield',
          fieldLabel: 'Start Year',
          name: 'start_date_year'
        }, {
          xtype: 'textfield',
          fieldLabel: 'End Year',
          name: 'end_date_year'
        }, {
          xtype: 'combobox',
          fieldLabel: 'Status',
          name: 'status',
          queryMode: 'local',
          store: 'ProjectStatus',
          displayField: 'status',
          valueField: 'status'
        }, {
          xtype: 'combobox',
          fieldLabel: 'Source Agency',
          queryMode: 'remote',
          triggerAction: 'all',
          minChars: 3,
          typeAhead: true,
          name: 'source_agency_id',
          store: source_agencies,
          displayField: 'name_with_acronym',
          valueField: 'id'
        }, {
          xtype: 'combobox',
          fieldLabel: 'Other Agencies',
          queryMode: 'local',
          triggerAction: 'all',
          editable: false,
          minChars: 3,
          name: 'agency_ids',
          store: agencies,
          displayField: 'name_with_acronym',
          multiSelect: true,
          valueField: 'id'
        }]
      });       
      
      this.callParent(arguments);
      
      console.log(this.down('#pagency'));
      
      Ext.Ajax.request({
        url: '/catalog/' + this.getRecordId() + '.json',
        success: this.onRequestSuccess,
        scope: this
      });
    },
    onRequestSuccess: function(response){
      this.record = Ext.JSON.decode(response.responseText);
      this.setTitle(this.titleTpl.apply(this.record));
      this.getForm().setValues(this.record);
    }
});
.row-fluid
  .section-nav.span4
    %ul.nav.nav-list.affix{ data: { spy: 'affix' } }
      - sections = %w{ general contacts agencies tags collections links locations sds downloads actions }
      - sections.each do |section|
        %li{class: (section == sections.first ? 'active' : '')}
          = link_to section.humanize, "##{section}"
      
  .span8
    = nested_form_for [:manager, @catalog], html: { class: 'form' } do |f|
      - unless @catalog.errors.full_messages.empty?
        .alert.alert-error
          %h4 Errors prevents this record from being saved
          %ul
            - @catalog.errors.full_messages.each do |err|
              %li= err
      %section#general
        %h2 General
        = render 'general_fields', f: f
        
      %section#contacts
        %h2 Contacts
        = render 'contact_fields', f: f
    
      %section#agencies
        %h2 Agencies
        = render 'agency_fields', f: f
    
      %section#tags
        %h2 Tags
        = render 'tag_fields', f: f

      %section#collections
        %h2 Collections
        = render 'collection_fields', f: f

      %section#links 
        .pull-right
          = f.link_to_add :links, :data => { :target => "#links" }, class: "btn btn-success" do
            %i.icon-plus.icon-white
            Add a Link
        %h2 Links
        .header.row-fluid
          .span2 Category
          .span4 Display Text
          .span4 URL
          .span2.actions Actions
        .body
          .links
            = f.fields_for :links
    
      %section#locations
        .pull-right
          = f.link_to_add :locations, :data => { :target => "#locations" }, class: "btn btn-success" do
            %i.icon-plus.icon-white
            Add a Location
        %h2 Locations
        .header.row-fluid
          .span4 Name
          .span6 WKT
          .span2.actions Actions
        .body
          .locations
            = f.fields_for :locations

      %section#sds
        %h2 Secure Data System
        = render 'sds_fields', f: f
      
      %section#downloads
        .pull-right
          = f.link_to_add :download_urls, :data => { :target => "#downloads" }, class: "btn btn-success" do
            %i.icon-plus.icon-white
            Add Download URL
        %h2 Downloads/Files
        .header.row-fluid
          .span4 Name
          .span6 URL
          .span2.actions Actions
        .body
          .downloads
            = f.fields_for :download_urls

      %section#actions.form-actions
        = link_to [:manager, @catalog], class: 'btn btn-inverse' do
          %i.icon-arrow-left.icon-white
          Back
          
        = f.submit class: 'btn btn-primary pull-right'
    

/ refresh because of select2 moving things around on the page
:javascript
  $(document).ready(function() {
    $('[data-spy="scroll"]').each(function() {
      $(this).delay(500).scrollspy('refresh');
    })
  })
.row-fluid
  .section-nav.span4
    %ul.nav.nav-list.affix{ data: { spy: 'affix' } }
      - sections = %w{ general contacts agencies tags collections links locations downloads sds actions }
      - sections.each do |section|
        %li{class: (section == sections.first ? 'active' : '')}
          = link_to section.humanize, "##{section}"
      
  .span8
    = form_for [:manager, @catalog], html: { class: 'form' } do |f|
      - unless @catalog.errors.full_messages.empty?
        .alert.alert-error
          %h4 Errors prevents this record from being saved
          %ul
            - @catalog.errors.full_messages.each do |err|
              %li= err
      %section#general
        %h2 General
        = render 'general_fields', f: f
        
      %section#contacts
        %h2 Contacts
        = render 'contact_fields', f: f
    
      %section#agencies
        %h2 Agencies
        = render 'agency_fields', f: f
    
      %section#tags
        %h2 Tags
        = render 'tag_fields', f: f

      %section#collections
        %h2 Collections
        = render 'collection_fields', f: f

      %section#links 
        %h2 Links
        .links
          .header.row-fluid
            .span2 Category
            .span4 Display Text
            .span4 URL
            .span2.actions Actions
          .body
            = f.fields_for :links do |link_builder|
              = render partial: 'link_fields', locals: { f: link_builder }
          .clearfix{style:"margin-top:3px;"}
            = link_to_add_fields "<i class='icon-plus icon-white'></i> Add Link".html_safe, f, :links, { class: 'btn btn-success pull-right' }
            / = link_to '#', class: 'btn btn-success pull-right' do
            /   %i.icon-plus.icon-white
            /   Add link
    
      %section#locations
        %h2 Locations
        .locations
          .header.row-fluid
            .span4 Name
            .span6 WKT
            .span2.actions Actions
          .body
            = f.fields_for :locations do |location|
              = render partial: 'location_fields', locals: { f: location }
          .clearfix{style:"margin-top:3px;"}
            = link_to_add_fields "<i class='icon-plus icon-white'></i> Add Location".html_safe, f, :locations, { class: 'btn btn-success pull-right' }

      %section#downloads
        %h2 Downloads/Files
        = render 'download_fields', f: f

      %section#sds
        %h2 Secure Data System
        = render 'sds_fields', f: f
      
      %section#actions.form-actions
        = link_to [:manager, @catalog], class: 'btn btn-inverse' do
          %i.icon-arrow-left.icon-white
          Back
          
        = f.submit class: 'btn btn-primary pull-right'
    

/ refresh because of select2 moving things around on the page
:javascript
  $(document).ready(function() {
    $('[data-spy="scroll"]').each(function() {
      $(this).delay(500).scrollspy('refresh');
    })
  })
/ %h4= "Log for #{@log.created_at}"
/ 
.content
  - if @import_counts
    .row-fluid
      .span6
        %dl.dl-horizontal
          %dt Last run started:
          %dd= @import_start.created_at
          %dt Ended:
          %dd= @import_counts.created_at
      .span6
        %dl.dl-horizontal
          %dt Created/updated: 
          %dd= @import_counts.log[:counts][:success]
          %dt Errors: 
          %dd= @import_counts.log[:counts][:error]

.tabbable
  %ul.nav.nav-tabs
    %li.active{ style: 'margin-left: 10px;' }= link_to 'Import Errors', '#import-errors', data: { toggle: 'tab' }
    %li= link_to 'Agency Errors', '#agency-errors', data: { toggle: 'tab' }
    %li= link_to 'Import messages', '#import-messages', data: { toggle: 'tab' }
    %li= link_to "Unknown Agencies", "#unknown_agencies", data: {toggle: 'tab'}
  
  .tab-content
    #import-errors.tab-pane.active
      - @logs.import_errors.each do |log|
        .row-fluid{ style: 'margin-top: 5px;' }
          .span3.content
            %b= log.activity.underscore.humanize.upcase
            %br/
            = log.created_at
          .span9.content
            %b Catalog record:
            = link_to log.loggable, log.loggable
        .row-fluid{ style: 'border-bottom: 1px solid #efefef; padding-bottom: 5px;' }
          .span12.content
            %b Source:
            = link_to log.loggable.source_url, log.loggable.source_url
            %br/
            %b Message:
            = log.log[:message].html_safe if log.log[:message].present?
    
    #unknown_agencies.tab-pane
      - @unknown_agencies.each do |agency|
        - next if Agency.exists_by_name_or_alias?(agency)
        = render 'unknown_agency', unknown_agency: agency
      
    #agency-errors.tab-pane
      - @logs.agency_import_errors.each do |log|
        .row-fluid{ style: 'margin-top: 5px;' }
          .span3.content
            %b= log.activity.underscore.humanize.upcase
            %br/
            = log.created_at
          .span9.content
            %b Catalog record:
            = link_to log.loggable, log.loggable
        .row-fluid{ style: 'border-bottom: 1px solid #efefef; padding-bottom: 5px;' }
          .span12.content
            %b Source:
            = link_to log.loggable.source_url, log.loggable.source_url
            %br/
            %b Message:
            = log.log[:message].html_safe if log.log[:message].present?
            
    #import-messages.tab-pane
      - @logs.import_log.each do |log|
        .row-fluid{ style: 'margin-top: 5px;' }
          .span3.content
            %b= log.activity.underscore.humanize.upcase
            %br/
            = log.created_at
          .span9.content
            %b Catalog record:
            = link_to log.loggable, log.loggable
        .row-fluid{ style: 'border-bottom: 1px solid #efefef; padding-bottom: 5px;' }
          .span12.content
            %b Source:
            = link_to log.loggable.source_url, log.loggable.source_url
            %br/
            %b Message:
            = log.log[:message].html_safe if log.log[:message].present?         
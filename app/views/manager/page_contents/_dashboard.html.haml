.navbar.navbar-static-top
  .navbar-inner
    .brand Pages
    #not-sorting.pull-right.btn-group
      = link_to '#', class: 'btn', id: 'sort-btn' do
        %i.icon-random
        Reorder Pages
      = link_to new_manager_page_content_path, class: 'btn btn-success' do
        %i.icon-plus.icon-white
        New Page
    #sorting.pull-right.btn-group{style: 'display:none;'}
      = link_to manager_page_contents_path, class: 'btn btn-warning', data: {confirm: "Are you sure?"} do
        %i.icon-remove.icon-white
        Cancel
      = link_to '#', class: 'btn btn-primary', id: 'finish-sort-btn' do
        %i.icon-ok.icon-white
        Finish Page Reorder
%ol#page-content-list.page-list.sortable
  - current_setup.pages.roots.each do |page|
    = render '/manager/page_contents/page', page: page

:javascript
  $(document).on('click', '[data-behavior="toggle-icon"]', function(){
    var target = $(this).data('target')
    if($(target).hasClass('in')) {
      $(this).find('i').addClass('icon-folder-open').removeClass('icon-folder-close'); 
    } else {
      $(this).find('i').removeClass('icon-folder-open').addClass('icon-folder-close'); 
    }
  })

  $('#sort-btn').on('click', function() {
    $('#page-content-list').nestedSortable({
      handle: 'div',
      items: 'li',
      toleranceElement: '> div'
    });
    
    $('#not-sorting.btn-group').hide();
    $('#sorting.btn-group').show();
  });
  
  $('#finish-sort-btn').on('click', function() {
    $('#not-sorting.btn-group').show();
    $('#sorting.btn-group').hide();
    
    var results = $('#page-content-list').nestedSortable('toHierarchy');
    $.post('#{sort_manager_page_contents_path}', { pages: results });
  });
